! Script de validation VPN IPsec - Projet VPN-DNAC
! Description: Commandes de validation pour vérifier le fonctionnement du tunnel VPN

! ==========================================
! VALIDATION TUNNEL VPN - HQ ROUTER
! ==========================================

! Vérification de l'état IKEv2
show crypto ikev2 sa
show crypto ikev2 proposal
show crypto ikev2 policy
show crypto ikev2 profile

! Vérification des sessions IPsec
show crypto ipsec sa
show crypto ipsec transform-set
show crypto ipsec profile

! Vérification de l'interface tunnel
show interfaces tunnel 0
show ip route | include Tunnel

! Vérification de la connectivité tunnel
ping 10.0.0.2 source Tunnel0
ping 192.168.2.1 source Tunnel0

! Vérification du trafic crypté
show crypto engine connections active
show crypto engine statistics

! Test de connectivité inter-réseaux
ping 192.168.2.10 source 192.168.1.1
traceroute 192.168.2.10

! ==========================================
! VALIDATION TUNNEL VPN - BRANCH ROUTER
! ==========================================

! Vérification de l'état IKEv2
show crypto ikev2 sa
show crypto ikev2 proposal
show crypto ikev2 policy
show crypto ikev2 profile

! Vérification des sessions IPsec
show crypto ipsec sa
show crypto ipsec transform-set
show crypto ipsec profile

! Vérification de l'interface tunnel
show interfaces tunnel 0
show ip route | include Tunnel

! Vérification de la connectivité tunnel
ping 10.0.0.1 source Tunnel0
ping 192.168.1.1 source Tunnel0

! Vérification du trafic crypté
show crypto engine connections active
show crypto engine statistics

! Test de connectivité inter-réseaux
ping 192.168.1.10 source 192.168.2.1
traceroute 192.168.1.10

! ==========================================
! VALIDATION PC VIRTUELS - CONNECTIVITÉ VPN
! ==========================================

! Depuis HQ-PC (192.168.1.10)
ping 192.168.2.10
ping 192.168.2.1
traceroute 192.168.2.10

! Depuis Branch-PC (192.168.2.10)
ping 192.168.1.10
ping 192.168.1.1
traceroute 192.168.1.10

! ==========================================
! VALIDATION PERFORMANCE ET SÉCURITÉ
! ==========================================

! Surveillance des performances
show processes cpu | include crypto
show memory | include crypto

! Vérification des logs de sécurité
show logging | include crypto
show logging | include IKEv2

! Statistiques détaillées
show crypto ikev2 stats
show crypto ipsec stats

! ==========================================
! COMMANDES DE DÉPANNAGE
! ==========================================

! Redémarrer le tunnel VPN (si nécessaire)
clear crypto ikev2 sa
clear crypto ipsec sa

! Vérifier la configuration
show running-config | include crypto
show running-config | include tunnel

! Test de connectivité étape par étape
ping 203.0.113.2 source 203.0.113.6  ! Branch -> HQ (public)
ping 203.0.113.6 source 203.0.113.2  ! HQ -> Branch (public)
ping 10.0.0.1 source 10.0.0.2        ! Tunnel Branch -> HQ
ping 10.0.0.2 source 10.0.0.1        ! Tunnel HQ -> Branch
